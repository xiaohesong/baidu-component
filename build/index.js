"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var React=require("react"),__assign=function(){return(__assign=Object.assign||function(e){for(var n,t=1,a=arguments.length;a>t;t++)for(var i in n=arguments[t])Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i]);return e}).apply(this,arguments)};function __awaiter(e,n,t,a){return new(t||(t=Promise))(function(i,o){function r(e){try{s(a.next(e))}catch(e){o(e)}}function c(e){try{s(a.throw(e))}catch(e){o(e)}}function s(e){e.done?i(e.value):new t(function(n){n(e.value)}).then(r,c)}s((a=a.apply(e,n||[])).next())})}function __generator(e,n){var t,a,i,o,r={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(t)throw new TypeError("Generator is already executing.");for(;r;)try{if(t=1,a&&(i=2&o[0]?a.return:o[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,o[1])).done)return i;switch(a=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return r.label++,{value:o[1],done:!1};case 5:r.label++,a=o[1],o=[0];continue;case 7:o=r.ops.pop(),r.trys.pop();continue;default:if(!(i=(i=r.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){r=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&i[3]>o[1])){r.label=o[1];break}if(6===o[0]&&i[1]>r.label){r.label=i[1],i=o;break}if(i&&i[2]>r.label){r.label=i[2],r.ops.push(o);break}i[2]&&r.ops.pop(),r.trys.pop();continue}o=n.call(e,r)}catch(e){o=[6,e],a=0}finally{t=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}}var defaultColor="#1890ff",defaultStrokeWeight=3,defaultStrokeOpacity=.8,pointsIcon={expectStart:{icon:"预估起点图标",dateTime:"",desc:"预估订单起点"},expectEnd:{icon:"预估终点图标",dateTime:"",desc:"预估订单终点"},driverStart:{icon:"司机接单点图标",dateTime:"",desc:"司机接单点"},driverWait:{icon:"司机等待点",dateTime:"",desc:"司机等待点"},passengerGetOn:{icon:"乘客上车点",dateTime:"",desc:"乘客上车点"},start:{icon:"订单起点",dateTime:"",desc:"订单起点"},passengerGetOff:{icon:"乘客下车点",dateTime:"",desc:"乘客下车点"},end:{icon:"订单终点",dateTime:"",desc:"订单终点(发起收款)"}};function handleDraw(e){var n=e.map,t=e.configs,a=!t.infoWindow||!1!==t.infoWindow.able;function i(e){Object.keys(e).forEach(function(i){var o=e[i],r=o.point,c=o.icon,s=pointsIcon[i];s=__assign({},s,{dateTime:o.dateTime,title:o.desc});var l=new window.BMap.Icon(c||s.icon,new window.BMap.Size(23,25),{}),d=new window.BMap.Point(r.shift(),r.pop()),p=new window.BMap.Marker(d,{icon:l});a&&p.addEventListener("click",function(){return function(e,n){var a=e.getPosition(),i=n.dateTime,o=void 0===i?"":i,r=new window.BMap.InfoWindow("<div>\n      <p class='mb2'><span class='pr10'>经度:</span><span>"+a.lng+"</span></p>\n      <p class='mb2'><span class='pr10'>维度:</span><span>"+a.lat+"</span></p>\n      "+(o&&"<p class='mb2'><span class='pr10'>时间:</span><span>"+o+"</span></p>")+"\n    </div>",__assign({},t.infoWindow,{title:n.title}));e.openInfoWindow(r)}(p,s)}),n.addOverlay(p)})}return function(e){var a=t.lines[e]||{},o=a.line,r=a.points,c=a.strokeColor,s=a.strokeWeight,l=a.strokeOpacity;!function(e,t,a){var o=[];JSON.parse(JSON.stringify(e)).forEach(function(e){o.push(new window.BMap.Point(e.shift(),e.pop()))}),i(JSON.parse(JSON.stringify(t)));var r=new window.BMap.Polyline(o,{strokeColor:a.strokeColor,strokeWeight:a.strokeWeight,strokeOpacity:a.strokeOpacity});n.addOverlay(r)}(void 0===o?[]:o,void 0===r?{}:r,{strokeColor:void 0===c?defaultColor:c,strokeWeight:void 0===s?defaultStrokeWeight:s,strokeOpacity:void 0===l?defaultStrokeOpacity:l})}}var FIRST_POSITION=0;function drawMap(e){return __awaiter(this,void 0,void 0,function(){var n,t,a,i,o,r,c,s,l;return __generator(this,function(d){for(s in n=e.map,t=e.showables,a=e.configs,o=(i=e.configs.lines)[Object.keys(i)[FIRST_POSITION]].line[FIRST_POSITION],r=new((l=window.BMap.Point).bind.apply(l,[void 0].concat(a.center?a.center:o))),n.centerAndZoom(r,15),n.clearOverlays(),c=handleDraw(__assign({},e,{map:n,showables:t})),t)t[s]&&!1!==i[s].able&&c(s);return[2]})})}var AK="olqtPciVr8PWFoKFnNWof0j0uIMukGE4";function loadScript(e){return void 0===e&&(e=AK),window.BMap||window.mapLoader?window.mapLoader:window.mapLoader=new Promise(function(n){var t=document.createElement("script");t.src="https://api.map.baidu.com/api?v=2.0.0&ak="+e+"&callback=initBMapCallBack",document.body.appendChild(t),window.initBMapCallBack=function(){n(window.BMap),document.body.removeChild(t),delete window.initBMapCallBack}})}function init(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(n){switch(n.label){case 0:return[4,loadScript()];case 1:return n.sent(),(e=new window.BMap.Map("container")).enableScrollWheelZoom(),[2,e]}})})}function styleInject(e,n){void 0===n&&(n={});var t=n.insertAt;if(e&&"undefined"!=typeof document){var a=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css","top"===t&&a.firstChild?a.insertBefore(i,a.firstChild):a.appendChild(i),i.styleSheet?i.styleSheet.cssText=e:i.appendChild(document.createTextNode(e))}}var css=".lineDesc {\n  display: inline-block;\n  padding-right: 3.125rem;\n  border-radius: 5px;\n  cursor: pointer;\n}\n\n.lineDesc span {\n  display: inline-block;\n  position: relative;\n  bottom: 4px;\n  width: 100px;\n  height: 2px;\n  margin: 0 auto;\n  padding: 0;\n  background-color: #D5D5D5;\n  overflow: hidden;\n}\n\n.mb2 {\n  margin-bottom: 2px;\n}\n\n.pr10 {\n  padding-right: 10px;\n}";styleInject(css);var map,disabledColor="rgba(0,0,0,0.25)";function MapHeadDesc(e){var n=e.configs.lines,t=e.showables,a=function(n){var t=n.target.id;t&&e.toggle(t)};return React.useCallback(function(){return React.createElement("div",{onClick:a},Object.keys(n).map(function(e){var a=n[e],i=t[e];return!1!==n[e].able&&React.createElement("div",{id:e,key:e,className:"lineDesc",style:{color:i?"":disabledColor,textDecoration:i?"":"line-through"}},a.desc,"：",React.createElement("span",{style:{backgroundColor:a.strokeColor}}))}))},[t])()}function BMap(e){var n=this,t=e.configs,a=Object.keys(t.lines).reduce(function(e,n){return e[n]=!1!==t.lines[n].showable,e},{}),i=React.useState(a),o=i[0],r=i[1];React.useMemo(function(){return __awaiter(n,void 0,void 0,function(){return __generator(this,function(e){return map=init(),[2]})})},[]),React.useEffect(function(){return function(){delete window.mapLoader,delete window.BMap,map=null}},[]),React.useEffect(function(){map.then(function(n){drawMap(__assign({},e,{map:n,showables:o}))})},[o]);var c=e.style||{width:500,height:300},s=function(e){r(function(n){var t;return __assign({},n,((t={})[e]=!n[e],t))})},l=!1!==t.headerable;return React.createElement(React.Fragment,null,React.createElement(function(){return l?React.createElement(MapHeadDesc,__assign({},e,{showables:o,toggle:s})):null},null),React.createElement("div",{id:"container",style:c}))}exports.default=BMap;
