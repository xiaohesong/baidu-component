"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var React=require("react"),__assign=function(){return(__assign=Object.assign||function(e){for(var t,n=1,o=arguments.length;o>n;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)};function __awaiter(e,t,n,o){return new(n||(n=Promise))(function(a,r){function i(e){try{l(o.next(e))}catch(e){r(e)}}function c(e){try{l(o.throw(e))}catch(e){r(e)}}function l(e){e.done?a(e.value):new n(function(t){t(e.value)}).then(i,c)}l((o=o.apply(e,t||[])).next())})}function __generator(e,t){var n,o,a,r,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return r={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function c(r){return function(c){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,o&&(a=2&r[0]?o.return:r[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,r[1])).done)return a;switch(o=0,a&&(r=[2&r[0],a.value]),r[0]){case 0:case 1:a=r;break;case 4:return i.label++,{value:r[1],done:!1};case 5:i.label++,o=r[1],r=[0];continue;case 7:r=i.ops.pop(),i.trys.pop();continue;default:if(!(a=(a=i.trys).length>0&&a[a.length-1])&&(6===r[0]||2===r[0])){i=0;continue}if(3===r[0]&&(!a||r[1]>a[0]&&a[3]>r[1])){i.label=r[1];break}if(6===r[0]&&a[1]>i.label){i.label=a[1],a=r;break}if(a&&a[2]>i.label){i.label=a[2],i.ops.push(r);break}a[2]&&i.ops.pop(),i.trys.pop();continue}r=t.call(e,i)}catch(e){r=[6,e],o=0}finally{n=a=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,c])}}}var defaultExpectColor="#f5222d",defaultTrajectoryColor="#1890ff",defaultStrokeWeight=3,defaultStrokeOpacity=.8,baseConfig={center:[120.120716,30.279077],infoWindow:{able:!0,width:240,height:120},expect:{able:!0,showable:!0,strokeColor:"#f5222d",strokeWeight:3,line:[[120.110311,30.287103],[120.110468,30.287115],[120.110662,30.287127],[120.111029,30.287139],[120.111597,30.287249]],points:{expectStart:{point:[120.110311,30.287103],icon:"0",desc:"预估订单起点"},expectEnd:{point:[120.111597,30.287249],icon:"1",desc:"预估订单起点"}}},trajectory:{able:!0,showable:!0,strokeColor:"#1890ff",strokeWeight:3,line:[[120.120716,30.279077],[120.121656,30.279089],[120.12288,30.279125],[120.124034,30.279162],[120.124801,30.279167]],points:{driverStart:{point:[120.120716,30.279077],icon:"0",dateTime:"",desc:"司机接单点"},driverWait:{point:[120.121656,30.279089],icon:"1",dateTime:"",desc:"司机等待点"},passengerGetOn:{point:[120.12288,30.279125],icon:"2",dateTime:"",desc:"乘客上车点"},start:{point:[120.121656,30.279089],icon:"3",dateTime:"",desc:"订单起点"},passengerGetOff:{point:[120.124034,30.279162],icon:"4",dateTime:"",desc:"乘客下车点"},end:{point:[120.124801,30.279167],icon:"5",dateTime:"",desc:"订单终点(发起收款)"}}}},fakeConfig={expect:{able:!1,line:[[120.110311,30.287103],[120.110468,30.287115],[120.110662,30.287127],[120.111029,30.287139],[120.111597,30.287249]],points:{expectStart:{point:[120.110311,30.287103]}}},trajectory:{able:!1,line:[[120.120716,30.279077],[120.121656,30.279089],[120.12288,30.279125],[120.124034,30.279162],[120.124801,30.279167]],points:{end:{point:[120.124801,30.279167]}}}},pointsIcon={expectStart:{icon:"预估起点图标",dateTime:"",desc:"预估订单起点"},expectEnd:{icon:"预估终点图标",dateTime:"",desc:"预估订单终点"},driverStart:{icon:"司机接单点图标",dateTime:"",desc:"司机接单点"},driverWait:{icon:"司机等待点",dateTime:"",desc:"司机等待点"},passengerGetOn:{icon:"乘客上车点",dateTime:"",desc:"乘客上车点"},start:{icon:"订单起点",dateTime:"",desc:"订单起点"},passengerGetOff:{icon:"乘客下车点",dateTime:"",desc:"乘客下车点"},end:{icon:"订单终点",dateTime:"",desc:"订单终点(发起收款)"}},colorDesc={expect:defaultExpectColor,trajectory:defaultTrajectoryColor};function handleDraw(e){var t=e.map,n=e.configs,o=!n.infoWindow||!1!==n.infoWindow.able;function a(e){Object.keys(e).forEach(function(a){var r=e[a],i=r.point,c=r.icon,l=pointsIcon[a];l=__assign({},l,{dateTime:r.dateTime,title:r.desc});var s=new window.BMap.Icon(c||pointsIcon[a],new window.BMap.Size(23,25),{}),p=new window.BMap.Point(i.shift(),i.pop()),d=new window.BMap.Marker(p,{icon:s});o&&d.addEventListener("click",function(){return function(e,t){var o=e.getPosition(),a=t.dateTime,r=void 0===a?"":a,i=new window.BMap.InfoWindow("<div>\n      <p class='mb2'>地址：杭州市西湖区！</p>\n      <p class='mb2'><span class='pr10'>经度:</span><span>"+o.lng+"</span></p>\n      <p class='mb2'><span class='pr10'>维度:</span><span>"+o.lat+"</span></p>\n      "+(r&&"<p class='mb2'><span class='pr10'>时间:</span><span>"+r+"</span></p>")+"\n    </div>",__assign({},n.infoWindow,{title:t.title}));e.openInfoWindow(i)}(d,l)}),t.addOverlay(d)})}function r(e){var o=n[e],r=o.strokeColor,i=o.strokeWeight,c=o.strokeOpacity;!function(e,n,o){var r=[];JSON.parse(JSON.stringify(e)).forEach(function(e){r.push(new window.BMap.Point(e.shift(),e.pop()))}),a(JSON.parse(JSON.stringify(n)));var i=new window.BMap.Polyline(r,{strokeColor:o.strokeColor,strokeWeight:o.strokeWeight,strokeOpacity:o.strokeOpacity});t.addOverlay(i)}(o.line,o.points,{strokeColor:void 0===r?colorDesc[e]:r,strokeWeight:void 0===i?defaultStrokeWeight:i,strokeOpacity:void 0===c?defaultStrokeOpacity:c})}return{expecter:function(e){r(e)},trajectorier:function(e){r(e)}}}var EXPECT_TYPE="expect",TRAJECTORY_TYPE="trajectory";function drawMap(e){return __awaiter(this,void 0,void 0,function(){var t,n,o,a,r,i,c,l,s;return __generator(this,function(p){return t=e.map,n=e.trajectoryShowable,o=e.expectShowable,a=e.configs,r=!1!==e.configs.expect.able&&o,i=!1!==e.configs.trajectory.able&&n,c=new((s=window.BMap.Point).bind.apply(s,[void 0].concat(a.center?a.center:a.expect.line[0]))),t.centerAndZoom(c,15),t.clearOverlays(),l=handleDraw(__assign({},e,{map:t,expectShowable:o,trajectoryShowable:n})),r&&l.expecter(EXPECT_TYPE),i&&l.trajectorier(TRAJECTORY_TYPE),[2]})})}var AK="olqtPciVr8PWFoKFnNWof0j0uIMukGE4";function loadScript(e){return void 0===e&&(e=AK),window.BMap||window.mapLoader?window.mapLoader:window.mapLoader=new Promise(function(t){var n=document.createElement("script");n.src="https://api.map.baidu.com/api?v=2.0.0&ak="+e+"&callback=initBMapCallBack",document.body.appendChild(n),window.initBMapCallBack=function(){t(window.BMap),document.body.removeChild(n),delete window.initBMapCallBack}})}function init(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:return[4,loadScript()];case 1:return t.sent(),(e=new window.BMap.Map("container")).enableScrollWheelZoom(),[2,e]}})})}function styleInject(e,t){void 0===t&&(t={});var n=t.insertAt;if(e&&"undefined"!=typeof document){var o=document.head||document.getElementsByTagName("head")[0],a=document.createElement("style");a.type="text/css","top"===n&&o.firstChild?o.insertBefore(a,o.firstChild):o.appendChild(a),a.styleSheet?a.styleSheet.cssText=e:a.appendChild(document.createTextNode(e))}}var css=".lineDesc {\n  display: inline-block;\n  padding-right: 3.125rem;\n  border-radius: 5px;\n  cursor: pointer;\n}\n\n.lineDesc span {\n  display: inline-block;\n  position: relative;\n  bottom: 4px;\n  width: 100px;\n  height: 2px;\n  margin: 0 auto;\n  padding: 0;\n  background-color: #D5D5D5;\n  overflow: hidden;\n}\n\n.mb2 {\n  margin-bottom: 2px;\n}\n\n.pr10 {\n  padding-right: 10px;\n}";styleInject(css);var map,disabledColor="rgba(0,0,0,0.25)";function MapHeadDesc(e){var t=e.configs.expect,n=t.strokeColor,o=void 0===n?defaultExpectColor:n,a=e.configs.trajectory,r=a.strokeColor,i=void 0===r?defaultTrajectoryColor:r,c=!1!==t.able,l=!1!==a.able,s=e.expectShowable,p=e.trajectoryShowable;function d(){c&&e.toggleExpect()}function u(){l&&e.toggleTrajectory()}var f={color:s?"":disabledColor,textDecoration:s?"":"line-through"},w={color:p?"":disabledColor,textDecoration:p?"":"line-through"};return React.useCallback(function(){return React.createElement(React.Fragment,null,c&&React.createElement("div",{className:"lineDesc",onClick:d,style:f},"预估路线：",React.createElement("span",{style:{backgroundColor:o}})),l&&React.createElement("div",{className:"lineDesc",onClick:u,style:w},"轨迹路线：",React.createElement("span",{style:{backgroundColor:i}})))},[s,p])()}function BMap(e){var t=this,n=e.configs||baseConfig;n.expect&&n.expect.line||(n.expect=fakeConfig.expect),n.trajectory&&n.trajectory.line||(n.trajectory=fakeConfig.trajectory);var o=!1!==n.trajectory.showable,a=React.useState(!1!==n.expect.showable),r=a[0],i=a[1],c=React.useState(o),l=c[0],s=c[1];React.useMemo(function(){return __awaiter(t,void 0,void 0,function(){return __generator(this,function(e){return map=init(),[2]})})},[]),React.useEffect(function(){return function(){delete window.mapLoader,delete window.BMap,map=null}},[]),React.useEffect(function(){map.then(function(t){drawMap(__assign({},e,{map:t,expectShowable:r,trajectoryShowable:l}))})},[r,l]);var p=e.style||{width:500,height:300};return React.createElement(React.Fragment,null,React.createElement(MapHeadDesc,__assign({},e,{expectShowable:r,trajectoryShowable:l,toggleExpect:function(){i(function(e){return!e})},toggleTrajectory:function(){s(function(e){return!e})}})),React.createElement("div",{id:"container",style:p}))}exports.default=BMap;
