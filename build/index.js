"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var React=require("react"),__assign=function(){return(__assign=Object.assign||function(e){for(var t,n=1,o=arguments.length;o>n;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};function __awaiter(e,t,n,o){return new(n||(n=Promise))(function(r,a){function i(e){try{l(o.next(e))}catch(e){a(e)}}function c(e){try{l(o.throw(e))}catch(e){a(e)}}function l(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(i,c)}l((o=o.apply(e,t||[])).next())})}function __generator(e,t){var n,o,r,a,i={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(a){return function(c){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,o&&(r=2&a[0]?o.return:a[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,a[1])).done)return r;switch(o=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,o=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(r=(r=i.trys).length>0&&r[r.length-1])&&(6===a[0]||2===a[0])){i=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&r[3]>a[1])){i.label=a[1];break}if(6===a[0]&&r[1]>i.label){i.label=r[1],r=a;break}if(r&&r[2]>i.label){i.label=r[2],i.ops.push(a);break}r[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],o=0}finally{n=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}var defaultExpectColor="#f5222d",defaultTrajectoryColor="#1890ff",defaultStrokeWeight=3,defaultStrokeOpacity=.8,baseConfig={center:[120.120716,30.279077],expect:{able:!0,showable:!0,strokeColor:"#f5222d",strokeWeight:3,line:[[120.110311,30.287103],[120.110468,30.287115],[120.110662,30.287127],[120.111029,30.287139],[120.111597,30.287249]],points:{expectStart:{point:[120.110311,30.287103],icon:"0"},expectEnd:{point:[120.111597,30.287249],icon:"1"}}},trajectory:{able:!0,showable:!0,strokeColor:"#1890ff",strokeWeight:3,line:[[120.120716,30.279077],[120.121656,30.279089],[120.12288,30.279125],[120.124034,30.279162],[120.124801,30.279167]],points:{driverStart:{point:[120.120716,30.279077],icon:"0"},driverWait:{point:[120.121656,30.279089],icon:"1"},passengerGetOn:{point:[120.12288,30.279125],icon:"2"},start:{point:[120.121656,30.279089],icon:"3"},passengerGetOff:{point:[120.124034,30.279162],icon:"4"},end:{point:[120.124801,30.279167],icon:"5"}}}},pointsIcon={expectStart:"预估起点图标",expectEnd:"预估终点图标",driverStart:"司机接单点图标",driverWait:"司机等等待点",passengerGetOn:"乘客上车点",start:"订单起点",passengerGetOff:"乘客下车点",end:"订单终点"},colorDesc={expect:defaultExpectColor,trajectory:defaultTrajectoryColor};function handleDraw(e){var t=e.map,n=e.configs;function o(e,n,o){var r=[];JSON.parse(JSON.stringify(e)).forEach(function(e){r.push(new window.BMap.Point(e.shift(),e.pop()))}),function(e){Object.keys(e).forEach(function(n){var o=e[n],r=o.point,a=new window.BMap.Icon(o.icon||pointsIcon[n],new window.BMap.Size(23,25),{}),i=new window.BMap.Point(r.shift(),r.pop()),c=new window.BMap.Marker(i,{icon:a});t.addOverlay(c)})}(JSON.parse(JSON.stringify(n)));var a=new window.BMap.Polyline(r,{strokeColor:o.strokeColor,strokeWeight:o.strokeWeight,strokeOpacity:o.strokeOpacity});t.addOverlay(a)}function r(e){var t=n[e],r=t.strokeColor,a=t.strokeWeight,i=t.strokeOpacity;o(t.line,t.points,{strokeColor:void 0===r?colorDesc[e]:r,strokeWeight:void 0===a?defaultStrokeWeight:a,strokeOpacity:void 0===i?defaultStrokeOpacity:i})}return{expecter:function(e){r(e)},trajectorier:function(e){r(e)}}}var EXPECT_TYPE="expect",TRAJECTORY_TYPE="trajectory";function drawMap(e){return __awaiter(this,void 0,void 0,function(){var t,n,o,r,a,i,c,l,s;return __generator(this,function(p){return t=e.map,n=e.trajectoryShowable,o=e.expectShowable,r=e.configs,a=!1!==e.configs.expect.able&&o,i=!1!==e.configs.trajectory.able&&n,c=new((s=window.BMap.Point).bind.apply(s,[void 0].concat(r.center?r.center:r.expect.line[0]))),t.centerAndZoom(c,15),t.clearOverlays(),l=handleDraw(__assign({},e,{map:t,expectShowable:o,trajectoryShowable:n})),a&&l.expecter(EXPECT_TYPE),i&&l.trajectorier(TRAJECTORY_TYPE),[2]})})}var AK="olqtPciVr8PWFoKFnNWof0j0uIMukGE4";function loadScript(e){return void 0===e&&(e=AK),window.BMap||window.mapLoader?window.mapLoader:window.mapLoader=new Promise(function(t){var n=document.createElement("script");n.src="https://api.map.baidu.com/api?v=2.0.0&ak="+e+"&callback=initBMapCallBack",document.body.appendChild(n),window.initBMapCallBack=function(){t(window.BMap),document.body.removeChild(n),delete window.initBMapCallBack}})}function init(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:return[4,loadScript()];case 1:return t.sent(),(e=new window.BMap.Map("container")).enableScrollWheelZoom(),[2,e]}})})}function styleInject(e,t){void 0===t&&(t={});var n=t.insertAt;if(e&&"undefined"!=typeof document){var o=document.head||document.getElementsByTagName("head")[0],r=document.createElement("style");r.type="text/css","top"===n&&o.firstChild?o.insertBefore(r,o.firstChild):o.appendChild(r),r.styleSheet?r.styleSheet.cssText=e:r.appendChild(document.createTextNode(e))}}var css=".lineDesc {\n  display: inline-block;\n  padding-right: 3.125rem;\n  border-radius: 5px;\n  cursor: pointer;\n}\n\n.lineDesc span {\n  display: inline-block;\n  position: relative;\n  bottom: 4px;\n  width: 100px;\n  height: 2px;\n  margin: 0 auto;\n  padding: 0;\n  background-color: #D5D5D5;\n  overflow: hidden;\n}";styleInject(css);var map,disabledColor="rgba(0,0,0,0.25)";function MapHeadDesc(e){var t=e.configs.expect,n=t.strokeColor,o=void 0===n?defaultExpectColor:n,r=t.showable,a=e.configs.trajectory,i=a.strokeColor,c=void 0===i?defaultTrajectoryColor:i,l=a.showable,s=!1!==t.able,p=!1!==a.able,u=!1!==r,d=!1!==l;function f(){s&&e.toggleExpect()}function w(){p&&e.toggleTrajectory()}var h={color:u?"":disabledColor,textDecoration:u?"":"line-through"},y={color:d?"":disabledColor,textDecoration:d?"":"line-through"};return React.useCallback(function(){return React.createElement(React.Fragment,null,s&&React.createElement("div",{className:"lineDesc",onClick:f,style:h},"预估路线：",React.createElement("span",{style:{backgroundColor:o}})),p&&React.createElement("div",{className:"lineDesc",onClick:w,style:y},"轨迹路线：",React.createElement("span",{style:{backgroundColor:c}})))},[r,l])()}function BMap(e){var t=this,n=e.configs||baseConfig,o=!1!==n.trajectory.showable,r=React.useState(!1!==n.expect.showable),a=r[0],i=r[1],c=React.useState(o),l=c[0],s=c[1];React.useMemo(function(){return __awaiter(t,void 0,void 0,function(){return __generator(this,function(e){return map=init(),[2]})})},[]),React.useEffect(function(){return function(){delete window.mapLoader,delete window.BMap,map=null}},[]),React.useEffect(function(){map.then(function(t){drawMap(__assign({},e,{map:t,expectShowable:a,trajectoryShowable:l}))})},[a,l]);var p=e.style||{width:500,height:300};return n=__assign({},n,{expect:__assign({},n.expect,{showable:a}),trajectory:__assign({},n.trajectory,{showable:l})}),React.createElement(React.Fragment,null,React.createElement(MapHeadDesc,__assign({},e,{configs:n,toggleExpect:function(){i(function(e){return!e})},toggleTrajectory:function(){s(function(e){return!e})}})),React.createElement("div",{id:"container",style:p}))}exports.default=BMap;
